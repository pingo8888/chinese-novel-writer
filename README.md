# Chinese Writer - Obsidian 插件

一个专为中文写作设计的 Obsidian 插件，可以将指定目录下的 Markdown 文件以树状结构的方式展示在右侧边栏中。

## 功能特性

### 📚 智能文档树

- **三层树状结构**：
  - 第一层：目录下的所有 Markdown 文件
  - 第二层：每个文件中的所有 H1 标题
  - 第三层：每个 H1 下的所有 H2 标题（不包括孤立的 H2）

### 🎯 数据读取

插件会自动解析并显示：
1. 指定目录下的所有 Markdown 文件
2. 文件中的所有 H1 标题
3. H1 下的所有 H2 标题（孤立的 H2 不包括）
4. H2 下的所有内容行（H2 和下一个 H1 之间，或两个 H2 之间的内容）

### ✨ 关键字高亮（新功能）

- **小说库与设定库对应**：
  - 配置多组"小说库 → 设定库"的对应关系
  - 在编辑小说库文件时，右侧自动显示对应的设定库内容
  - 设定库中的所有 H2 标题（关键字）会在小说文件中高亮显示

- **可自定义高亮样式**：
  - 背景色
  - 边框样式（实线、虚线、点线、双线）
  - 边框粗细
  - 边框颜色
  - 字体粗细（正常、粗体）
  - 字体样式（正常、斜体）
  - 文字颜色

### 🎨 界面设计

- **标题栏**：
  - 中间显示文件夹图标和目录名
  - 右侧有全部展开/折叠按钮
  
- **树状显示区**：
  - 独立滚动条
  - 清晰的层级缩进
  - 可展开/折叠的节点
  - 不同层级使用不同的图标和样式

## 安装方法

### 手动安装

1. 将插件文件夹复制到你的 Obsidian 仓库的 `.obsidian/plugins/` 目录下
2. 确保文件夹中包含以下文件：
   - `main.js`
   - `manifest.json`
   - `styles.css`
3. 在 Obsidian 中打开 **设置 → 社区插件**
4. 关闭安全模式（如果已开启）
5. 在已安装插件列表中找到 "Chinese Writer" 并启用

### 开发模式安装

1. 克隆此仓库到 `.obsidian/plugins/` 目录
2. 运行 `npm install` 安装依赖
3. 运行 `npm run dev` 启动开发模式（自动监听文件变化）
4. 或运行 `npm run build` 进行生产构建

## 使用方法

### 1. 配置文件夹对应关系

1. 打开 **设置 → Chinese Writer**
2. 在 "文件夹对应关系" 部分点击 **添加** 按钮
3. 在第一个弹出框中输入**小说库**路径（例如：`小说/第一部`）
4. 在第二个弹出框中输入**设定库**路径（例如：`设定/第一部`）
5. 可以添加多组对应关系
6. 点击 "删除" 按钮可以删除不需要的对应关系

**工作原理**：
- 当你打开小说库中的文件时，右侧树状视图会自动显示对应设定库的内容
- 设定库中所有 H2 标题会作为关键字，在小说文件中高亮显示
- 例如：设定库中有 `## 张三` 和 `## 李四`，这些名字在小说文件中会被高亮

### 2. 打开文档树视图

有三种方式打开视图：

1. **命令面板**：
   - 按 `Ctrl/Cmd + P` 打开命令面板
   - 输入 "打开文档树视图"
   - 选择并执行

2. **功能区图标**：
   - 点击左侧功能区的书本图标

3. **自动打开**：
   - 插件加载时会自动在右侧边栏打开视图

### 3. 使用树状视图

- **展开/折叠节点**：点击节点前的箭头图标
- **全部展开/折叠**：点击标题栏右侧的按钮
- **查看内容**：点击节点可以查看详细信息（在控制台中）

### 4. 自定义高亮样式

1. 打开 **设置 → Chinese Writer**
2. 在 "关键字高亮样式" 部分配置：
   - **背景色**：支持8位HEX颜色（例如 `#fff3cdff`，最后两位为透明度）
   - **边框样式**：选择实线、虚线、点线或双线
   - **边框粗细**：使用滑动条调整（0-10像素）
   - **边框颜色**：支持8位HEX颜色（例如 `#ffc107ff`）
   - **字体粗细**：选择正常或粗体
   - **字体样式**：选择正常或斜体
   - **文字颜色**：支持8位HEX颜色或 `inherit`（继承原有颜色）
3. 设置会实时生效

**颜色格式说明**：
- 6位HEX：`#RRGGBB`（例如 `#fff3cd`）
- 8位HEX：`#RRGGBBAA`（例如 `#fff3cdff`，最后两位AA为透明度，00=完全透明，ff=完全不透明）

## 文件结构要求

为了让插件正确解析你的文档，请遵循以下结构：

```markdown
# 第一章

## 第一节

这里是第一节的内容。
可以有多行。

## 第二节

这里是第二节的内容。

# 第二章

## 第一节

第二章第一节的内容。
```

**注意事项**：
- 使用标准的 Markdown 标题语法（`#` 后面要有空格）
- H2 必须在 H1 下面才会被收集
- 孤立的 H2（没有上级 H1）会被忽略
- H2 下的内容会被收集，直到遇到下一个标题

## 开发

### 项目结构

```
src/
├── main.ts              # 插件入口，生命周期管理
├── types.ts             # TypeScript 类型定义
├── settings.ts          # 设置界面和配置
├── parser.ts            # Markdown 文件解析器
├── tree-view.ts         # 树状视图组件
├── highlight-manager.ts # 关键字高亮管理器
└── order-manager.ts     # 文件排序管理器
```

### 构建命令

```bash
# 开发模式（监听文件变化）
npm run dev

# 生产构建
npm run build

# 代码检查
npm run lint
```

### 技术栈

- TypeScript
- Obsidian API
- esbuild（打包工具）

## 许可证

0-BSD License

## 作者

pingo8888

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### 0.2.1 (界面优化版本)

- 🎨 改进对应关系添加方式：使用两次弹出框依次输入小说库和设定库路径
- 🎨 边框粗细改用滑动条，更直观易用
- ✨ 支持8位HEX颜色（包含透明度通道）
- 🗑️ 移除向后兼容的单一目标文件夹配置，简化设置界面
- 📝 更新文档和使用说明

### 0.2.0 (关键字高亮版本)

- ✨ 新增小说库与设定库对应关系配置
- ✨ 支持多组文件夹对应关系
- ✨ 自动高亮设定库中的关键字（H2 标题）
- ✨ 可自定义高亮样式（背景色、边框、字体等）
- ✨ 根据当前打开的文件自动切换显示对应的设定库

### 0.1.0 (初始版本)

- ✨ 实现基本的树状结构显示
- ✨ 支持三层文档结构（文件 → H1 → H2）
- ✨ 可配置的目标文件夹
- ✨ 全部展开/折叠功能
- 🎨 美观的界面设计
